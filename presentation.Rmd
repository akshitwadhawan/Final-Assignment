---
title: "Investigating the Predictors of Violent Crime"
author: "Workshop 10 <br> Euan McKerron, Yujun Ling, Akshit Wadhawan & Ariane Baillie"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
---

```{r install-package, include = FALSE, eval = FALSE}
# Copy and paste the following code into your console to download and install
# the `xaringan` package that contains all of the code which allows you 
# to create presentation slides in Rmarkdown
```


```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(readxl)
library(janitor)
library(ggplot2)
library(lubridate)
library(zoo)
library(scales)
library(dplyr)
library(yardstick)
library(kableExtra)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
# Load your data here
data <- read_excel("data/Copy of Punishments.xlsx")

data_names <- data %>% janitor::clean_names()

data_type <- data_names %>%
  mutate(offence_type = ifelse(
    offence == "Violence", "Violent", "Non-Violent"
  )) %>%
  select(predominant_function_of_establishment, age_group, offence_type, sex)

data_type$age_group <- as.factor(data_type$age_group)
data_type$offence_type <- as.factor(data_type$offence_type)
data_type$predominant_function_of_establishment <- as.factor(data_type$predominant_function_of_establishment)
data_type$sex <- as.factor(data_type$sex)

colnames(data_type) <- c("est_type", "age_group", "offence_type", "sex")
```

```{r include=FALSE}

#Background image
style_xaringan(
  title_slide_background_image = "img/ministry of justice.jpg"
)
```


# Introduction

- This project looks at how different factors like age, sex, and location might influence the kinds of offences people commit and the sentences they receive. By looking at the patterns in the data, we can get a sense of whether these factors might actually help us predict future crime trends, and how their influence seems to shift over time.

---

# Data Overview

- This investigation draws on data from the Offender Management Statistics Quarterly: January to March 2023, published by the Ministry of Justice. The dataset offers detailed records on people entering, leaving, or serving sentences within the criminal justice system in England and Wales, giving a clear picture of how individuals move through the system.
- Our main variables after cleaning includes:
```{r, echo = FALSE, results = 'asis'}
Var_table <- data.frame(
  Variable = c("", "", ""),
  Type = c("", "", ""),
  Description = c("", "", "")
)

knitr::kable(Var_table)
```
These variables allow us to explore how age, sex, offence type, location, and sentence length relate to violent crime. Using official government data ensures the analysis is reliable and nationally representative.
---

#Exploratory statistics

The statistics suggest that offence type is influenced by several key variables:
- Age, this shows a strong effect, with younger offenders more likely to be involved in certain violent or high-risk offences, while older groups tend to appear more often in less impulsive or lower-severity categories. 

- Sex, this doesn’t seem to be major predictor, although overall males committed more crimes but the rate of violent versus non-violent is around the same. 

- Together, these variables indicate that offence type is not random but closely linked to demographic and contextual factors, with age showing the strongest influence in the data.

Write about what the statistics suggests about offence type being influenced by variables, and which variables show a strong influence

---

class: inverse, middle, center

# Initial Exploration and Data Visualisations

---

# Graphs
.pull-left[
```{r, echo = FALSE}

data <- read_excel("data/Copy of Punishments.xlsx")

#having to set the data into the different age categories

data <- data %>%
  mutate(
    `Age group` = factor(`Age group`, 
                         levels = c("15 - 17", "18 - 20", "21 - 24", "25 - 29",
                                    "30 - 39", "40 - 49", "50 - 59", "60 - 69", "70 and over")),
    `Predominant function of establishment` = factor(`Predominant function of establishment`)
  )

#making the graph having to make it into count plot so the frequency can be determined

ggplot(data,
       aes(
    x = `Age group`,
    y = `Predominant function of establishment`
)) +
    geom_count(color="Green", alpha = 0.7) +
    scale_size_area(max_size = 20) +
    labs(
        title = "Frequency of Establishment Function by Age Group",
        x = "Age group",
        y = "Predominant function of establishment",
        size = "Count"
    ) +
    theme_minimal()+ 
  theme( axis.text.x = element_text(angle = 45, hjust = 1) 
         )

#- Use `---` to separate slides and `--` for incremental builds


#- (describe what each bar plot shows in terms of changing proportion of violent to non-violent crimes, because sex doesnt have any change say why we discount it going forward in the investigation)

```
As you can see in this count plot it is clear that with the exception of youth institutions all the different establishments showed the highest number of inhabitants with individuals aged 30-39. 

]
.pull-right[
```{r, echo = FALSE}
data$`No of days` <- as.numeric(data$`No of days`)

data %>%
  group_by(`Age group`) %>%
  summarise(
    mean_days = mean(`No of days`, na.rm = TRUE),
    median_days = median(`No of days`, na.rm = TRUE),
    total_days = sum(`No of days`, na.rm = TRUE)
  )
```

This table highlights the disparity in the amount of time each age groups are spending in these establishments ]
---
#Number of prisoners by age 
.pull-left[ 
```{r,echo=FALSE, results='hide',message=FALSE}

# load your data 
data <- read_excel("data/criminal age dataset.xlsx")

#renaming column heading and cleaning the data so that mini headings are not in the age column
names(data)[1] <- "age"

clean_data <- data %>%
  filter(
    !age %in% c("Males and Females", "Remand", "Sentenced", "Non criminal prisoners")
  )

#removing the percentage change column

clean_data <- clean_data %>%
  select(-`Percentage change \r\nJune 2022 to 2023`)


#having to change the format of the data set to long form

data_long <- clean_data %>%
  pivot_longer(
    cols = -age,
    names_to = "date",
    values_to = "values"
  )

#forcing the value to be numeric 

data_long$values <- as.numeric(gsub(",", "", data_long$values))

#bar plot to compare age against total number of criminals

ggplot(data_long, aes(
    x = age,
    y = values / 1000,
    fill = date
    )) +
  geom_bar(stat="identity") +
  labs(
    x = "age categories",
    y = "number of prisoners in thousands",
    title = "Number of prisoners by age",
    subtitle = "data between 2022 and 2023",
    fill = "date")




```

We first found the number of prisoners per age group and found that the largest number of offenders are within the age range of  30-39. We found that the further away you move on either side of this category - the younger and/or older you get- there are less people in the prison system/ less offenders.]

.pull-right[
```{r, echo=FALSE}
percentage_by_age <- data_long %>%
  group_by(age) %>%
  summarise(total = sum(values, na.rm = TRUE)) %>%
  mutate(percent = total / sum(total) * 100)

percentage_by_age
```
This table highlights the percentage that an age group makes up of the overall prison poulation]
---
#Proportion of sentence lengths by age groups
.pull-left[
```{r, echo=FALSE,warning=FALSE, message=FALSE}
data <- read_excel("data/Age vs Sentence 1.0.xlsx")
names(data)[1] <- "Category"

data <- data %>%
  mutate(across(-Category, as.numeric),
         Total = rowSums(across(-Category), na.rm = TRUE))

age_groups <- c("Adults", "18-20 year olds", "15-17 year olds")

data_summary <- data %>%
  mutate(Age = if_else(Category %in% age_groups, Category, NA_character_)) %>%
  fill(Age) %>%
  filter(Category %in% c(
    "Less than or equal to 6 months",
    "Greater than 6 months to less than 12 months",
    "12 months to less than 4 years",
    "4 years or more (excluding indeterminate sentences)"
  )) %>%
  group_by(Age, Category) %>%
  summarise(Total = sum(Total, na.rm = TRUE)) %>%
  mutate(Proportion = Total / sum(Total))

ggplot(data_summary, aes(x = Age, y = Proportion, fill = Category)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = percent, breaks = seq(0, 1, 0.1)) +
  labs(
    title = "Proportion of Sentence Lengths by Age Group",
    subtitle = "From 2002-2023",
    x = "Age Group",
    y = "Proportion", 
    fill = "Sentence Length"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



```

```{r, echo=FALSE}
sentence_category <- data_summary %>%
  group_by(Category) %>%
  summarise(
    total = sum(Total)/1000,
    mean = mean(Total)/1000,
    median = median(Total)/1000,
    sd = sd(Total)/1000
  )

sentence_category
```
]

.pull-right[Shown in this graph is that the younger you are the more lenient the sentence length you get is, this could also show that younger people commit less severe/ harmful crimes compared to older age groups]
---

# Layouts

You can use plain text

- or bullet points

.pull-left[
or text in two columns $^*$
]
.pull-right[
- like
- this
]

.footnote[
[*] And add footnotes
]

---

# Code/ table example

.pull-left[
- Some text
- goes here
]
.pull-right[
```{r table, echo = FALSE}
# table, hiding the code with echo = FALSE
data_type_sex <- data_type %>%
  select(offence_type, sex) %>%
  mutate(
    count = n(),
    count = case_when(count == 37552 ~ 1),
    count = as.numeric(count))

data_type_sex_tibble <- data_type_sex %>%
  pivot_wider(
    names_from = sex,
    values_from = count,
    values_fn = sum
  )
as_tibble(data_type_sex_tibble)
```
]

---

# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r iris-table, echo = FALSE}
kable(head(iris), format = "html")
```

---

# Images

```{r castle, echo = FALSE, out.width = "55%", fig.align = "center", fig.cap = "Image credit: Photo by Jörg Angeli on Unsplash."}
include_graphics("img/edinburgh-castle.jpg")
```

Or you can also include a full page image. See next slide.

---


class: inverse, center, middle
background-image: url(img/edinburgh-castle.jpg)
background-size: contain
---

# Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

class: inverse, middle, center

# Modelling and Model Evaluation

---

# Add stuff to do with model here

---

class: inverse, middle, center

# Conclusion

---

# References

- Offender Management Statistics Quarterly: January to March 2023. Ministry of Justice, 2023. https://www.gov.uk/government/statistics/offender-management-statistics-quarterly-january-to-march-2023
